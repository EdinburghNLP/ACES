
<!DOCTYPE html>
<html>
  
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>File System Examples</title>
  <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
  <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
  <py-env>
    - paths:
      - ./main.py
      - ./annotations/subset.json
</py-env>
</head>
  
<body>
  <p> Testing here </p>
  <py-repl id="my-repl" auto-generate=true> </py-repl>

  <py-script src="main.py"></py-script>
  <div id="input">
    <label for="myfile">Select a file:</label>
    <input type="file" id="myfile" name="myfile">
    <div id="print_output"></div>
    <py-script output="print_output">
    import asyncio
    from js import document, FileReader
    from pyodide import create_proxy
    from main import Annotations
    import js
    def handler(loop, context):
        js.console.error(context.message)
        raise(context.exception)
    pyscript.loop.set_exception_handler(handler)
    
    annotations_obj = Annotations("./subset.json")
  
    def vis_item(res):
      document.getElementById("out_raw").innerHTML = res[0]
      for i in range(1, len(res)):
        ref, good, bad, spans = res[i]
        text = "\nReference: {}\nGood translation: {}\nIncorrect translation: {}".format(ref, good, bad)
        document.getElementById("debug").innerHTML += "in vis_item, our" + str(i) + " \n"
        document.getElementById("out"+str(i)).innerHTML = text

    async def process_file(event):
      fileList = event.target.files.to_py()
      document.getElementById("debug").innerHTML += "here: ", str(data)
      for f in fileList:
        data = await f.text()
        
        annotations_obj.add(data)
        
        if annotations_obj.i >= 0:
          res = annotations_obj.get_item()
        else:
          res = annotations_obj.next()
        print("res: ", res)
        vis_item(res)
    
    def main():
      # Create a Python proxy for the callback function
      # process_file() is your function to process events from FileReader
      file_event = create_proxy(process_file)
      
      # Set the listener to the callback
      e = document.getElementById("myfile")
      e.addEventListener("change", file_event, False)
      
    main()
    
    </py-script>
  </div>
  
  <div id="raw">
    <p>Sample</p>
    <div style="border:5px inset #c7299a;cursor:text;height:120px;overflow:auto;width:600px; resize:both">
      <div id="out_raw">
      </div>
    </div>
  </div>

  <!-- <py-box widths="1/4;1/4;1/4;1/4">-->
    <div>
      <p>Annotation 1</p>
      <div style="border:5px inset #f9b4cf;cursor:text;height:120px;overflow:auto; resize:both">
        <div id="out1">
        </div>
      </div>
    </div>
    <div>
      <p>Annotation 2</p>
      <div style="border:5px inset #bad8a6;cursor:text;height:120px;overflow:auto; resize:both">
        <div id="out2">
        </div>
      </div>
    </div>
    <div>
      <p>Annotation 3</p>
      <div style="border:5px inset #ecdeb5;cursor:text;height:120px;overflow:auto; resize:both">
        <div id="out3">
        </div>
      </div>
    </div>
    <div>
      <p>Annotation 4</p>
      <div style="border:5px inset #72bfef;cursor:text;height:120px;overflow:auto; resize:both">
        <div id="out4">
        </div>
      </div>
    </div>
  <!-- </py-box>-->


  <button py-click="next()" id="manual">Next</button>
  <py-script>
    def next():
      manual_div = Element("manual-write")
      manual_div.element.innerText = "Hello World"
    </py-script>

  <button py-click="write_to_page()" id="manual">Say Hello</button>
  <py-script>
    def write_to_page():
      manual_div = Element("manual-write")
      manual_div.element.innerText = "Hello World"
    </py-script>

  <p>Debugger:</p>
    <div style="border:2px inset #AAA;cursor:text;height:120px;overflow:auto;width:600px; resize:both">
      <div id="debug">
      </div>
  </div>

</body>
</html>
